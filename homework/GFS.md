# Google file system

计54 马子轩

仔细阅读Google File System这篇论文，并进行思考。回答下面的问题。

1. 上课的时候说过，如果要进行负载均衡的话，需要搜集各个Chunk Server的负载情况。设计你的负载均衡算法，包括如何搜集Chunk Server的负载，如何指导客户端选择最合适负载的Chunk Server来存储新创建的Chunk？

   在每个heartbeat时, 统计当前chunk server的磁盘利用率, 以及最近一段时间新创建chunk个数. 选择创建新chunk的chunk server时, 需要在保证该chunk server最近一段时间新创建chunk个数不超过一定数量的情况下, 尽量选择磁盘利用率比较低的chunk server. 另外, 从容错的角度来看, 需要保证同一个chunk的副本存在不同的机柜上. 保证该机柜故障的时候, 不会一次把所有副本全部丢失.

2. 在分布式文件系统设计的时候，将元数据存放到一个节点上是一种解决方案。设计一种将元数据分布到多台节点上的方案，并分析其优缺点。

   GFS中metadata是存放在master的内存中的. 显然, 这种方式的一个问题就是master挂掉之后就坏了. 将metadata分布到多个节点上的方法, 我考虑多个节点同时维护一个一致的metadata列表. 利用raft等一致性算法维护他的一致性. 显然, 从容错的角度来看, 他非常好. 但是他的操作代价太大. 比如进行任何操作的时候, 都会需要大量的网络操作, 需要占用大量时间还有网络资源. 因此综合来看远不如GFS中采用master和他的shadow这种方式来维护metadata来的合理.

3. 对于Posix语义来说，一个一致性的要求就是如果写入数据成功，文件系统返回成功，那么读出的数据应该就是最后一次写入的数据。但是，在Google File System中并不保证这一点。仔细阅读论文，举出例子来说明这种情况如何发生？了能够保证Posix的语义，在分布式文件系统中可以通过什么手段达到？在Google File System中，出现这种情况，应用程序如何处理？

   GFS中这种情况发生在并发写同一个数据块的情况下, 在写入过程中, 具体的写入顺序由primary replica决定. 这时并发写的内容就会出现顺序的变换. 由于GFS中数据和控制是分开的, 数据的传输是, 沿着一条精心挑选的chunk server链, 以求尽可能使用每台机器的网络带宽. 这种情况下, 不同client按时间顺序发送的写请求, 到达primary的顺序是不确定的. 这种情况下就会发生, 最终状态不是最后一个写入的状态这种情况. 从设计上, 抛弃掉数据与控制分开的做法即可. 但是这种情况不能够有效利用网络资源, 性能会下降. 在GFS中如果需要保证顺序, 可以通过限制同一时间同一文件只能允许一个写操作就可以达到. 但是, 相对的, 这样性能也会有所下降. 因此, 应该利用GFS的特性来规划应用程序的使用, 即不要干这种需要保序的事情, 来发挥出GFS的性能优势. 